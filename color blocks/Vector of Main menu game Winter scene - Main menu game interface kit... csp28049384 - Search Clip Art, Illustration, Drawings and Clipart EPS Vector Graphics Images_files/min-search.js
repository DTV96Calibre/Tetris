/**********************************************************************
 **********************************************************************
 ****  Can Stock Photo - Site JS Code
 ****  Copyright (c) 2011 Can Stock Photo Inc.
 **********************************************************************
 **********************************************************************
 ****  jQuery hashchange event - v1.3 - 7/21/2010
 ****  http://benalman.com/projects/jquery-hashchange-plugin/
 ****  Copyright (c) 2010 "Cowboy" Ben Alman
 ****  Dual licensed under the MIT and GPL licenses.
 ****  http://benalman.com/about/license/ 
 **********************************************************************
 **********************************************************************/
if(jQuery)(function($){$.extend($.fn,{miniColors:function(o,data){var create=function(input,o,data){var color=expandHex(input.val());if(!color)color='';var hsb=hex2hsb(color);var trigger=$('<a class="miniColors-trigger" style="background-color: #'+color+'" href="#"></a>');trigger.insertAfter(input);input.addClass('miniColors').data('original-maxlength',input.attr('maxlength')||null).data('original-autocomplete',input.attr('autocomplete')||null).data('letterCase','uppercase').data('trigger',trigger).data('hsb',hsb).data('change',o.change?o.change:null).data('close',o.close?o.close:null).data('open',o.open?o.open:null).attr('maxlength',8).attr('autocomplete','off').val((color)?'#'+convertCase(color,o.letterCase):'');if(o.readonly)input.prop('readonly',true);if(o.disabled)disable(input);trigger.bind('click.miniColors',function(event){event.preventDefault();if(input.val()==='')input.val('#');show(input);});input.bind('focus.miniColors',function(event){if(input.val()==='')input.val('#');show(input);});input.bind('blur.miniColors',function(event){var hex=expandHex(hsb2hex(input.data('hsb')));input.val(hex?'#'+convertCase(hex,input.data('letterCase')):'');});input.bind('keydown.miniColors',function(event){if(event.keyCode===9)hide(input);});input.bind('keyup.miniColors',function(event){setColorFromInput(input);});input.bind('paste.miniColors',function(event){setTimeout(function(){setColorFromInput(input);},5);});};var destroy=function(input){hide();input=$(input);input.data('trigger').remove();input.attr('autocomplete',input.data('original-autocomplete')).attr('maxlength',input.data('original-maxlength')).removeData().removeClass('miniColors').unbind('.miniColors');$(document).unbind('.miniColors');};var enable=function(input){input.prop('disabled',false).data('trigger').css('opacity',1);};var disable=function(input){hide(input);input.prop('disabled',true).data('trigger').css('opacity',0.5);};var show=function(input){if(input.prop('disabled'))return false;hide();var selector=$('<div class="miniColors-selector"></div>');selector.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').css({bottom:'22px',left:'0px',display:'none'}).addClass(input.attr('class'));var hsb=input.data('hsb');selector.find('.miniColors-colors').css('backgroundColor','#'+hsb2hex({h:hsb.h,s:100,b:100}));var colorPosition=input.data('colorPosition');if(!colorPosition)colorPosition=getColorPositionFromHSB(hsb);selector.find('.miniColors-colorPicker').css('top',colorPosition.y+'px').css('left',colorPosition.x+'px');var huePosition=input.data('huePosition');if(!huePosition)huePosition=getHuePositionFromHSB(hsb);selector.find('.miniColors-huePicker').css('top',huePosition.y+'px');input.data('selector',selector).data('huePicker',selector.find('.miniColors-huePicker')).data('colorPicker',selector.find('.miniColors-colorPicker')).data('mousebutton',0);input.parent().append(selector);selector.fadeIn(100);selector.bind('selectstart',function(){return false;});$(document).bind('mousedown.miniColors touchstart.miniColors',function(event){input.data('mousebutton',1);var testSubject=$(event.target).parents().andSelf();if(testSubject.hasClass('miniColors-colors')){event.preventDefault();input.data('moving','colors');moveColor(input,event);}
if(testSubject.hasClass('miniColors-hues')){event.preventDefault();input.data('moving','hues');moveHue(input,event);}
if(testSubject.hasClass('miniColors-selector')){event.preventDefault();return;}
if(testSubject.hasClass('miniColors'))return;hide(input);});$(document).bind('mouseup.miniColors touchend.miniColors',function(event){event.preventDefault();input.data('mousebutton',0).removeData('moving');}).bind('mousemove.miniColors touchmove.miniColors',function(event){event.preventDefault();if(input.data('mousebutton')===1){if(input.data('moving')==='colors')moveColor(input,event);if(input.data('moving')==='hues')moveHue(input,event);}});if(input.data('open')){input.data('open').call(input.get(0),'#'+hsb2hex(hsb),hsb2rgb(hsb));}};var hide=function(input){if(!input)input=$('.miniColors');input.each(function(){var selector=$(this).data('selector');$(this).removeData('selector');$(selector).fadeOut(100,function(){if(input.data('close')){var hsb=input.data('hsb'),hex=hsb2hex(hsb);input.data('close').call(input.get(0),'#'+hex,hsb2rgb(hsb));}
$(this).remove();});});$(document).unbind('.miniColors');};var moveColor=function(input,event){var colorPicker=input.data('colorPicker');colorPicker.hide();var position={x:event.pageX,y:event.pageY};if(event.originalEvent.changedTouches){position.x=event.originalEvent.changedTouches[0].pageX;position.y=event.originalEvent.changedTouches[0].pageY;}
position.x=position.x-input.data('selector').find('.miniColors-colors').offset().left-5;position.y=position.y-input.data('selector').find('.miniColors-colors').offset().top-5;if(position.x<=-5)position.x=-5;if(position.x>=144)position.x=144;if(position.y<=-5)position.y=-5;if(position.y>=144)position.y=144;input.data('colorPosition',position);colorPicker.css('left',position.x).css('top',position.y).show();var s=Math.round((position.x+5)*0.67);if(s<0)s=0;if(s>100)s=100;var b=100-Math.round((position.y+5)*0.67);if(b<0)b=0;if(b>100)b=100;var hsb=input.data('hsb');hsb.s=s;hsb.b=b;setColor(input,hsb,true);};var moveHue=function(input,event){var huePicker=input.data('huePicker');huePicker.hide();var position={y:event.pageY};if(event.originalEvent.changedTouches){position.y=event.originalEvent.changedTouches[0].pageY;}
position.y=position.y-input.data('selector').find('.miniColors-colors').offset().top-1;if(position.y<=-1)position.y=-1;if(position.y>=149)position.y=149;input.data('huePosition',position);huePicker.css('top',position.y).show();var h=Math.round((150-position.y-1)*2.4);if(h<0)h=0;if(h>360)h=360;var hsb=input.data('hsb');hsb.h=h;setColor(input,hsb,true);};var setColor=function(input,hsb,updateInput){input.data('trigger').removeClass('empty');input.data('hsb',hsb);var hex=hsb2hex(hsb);if(updateInput)input.val('#'+convertCase(hex,input.data('letterCase')));input.data('trigger').css('backgroundColor','#'+hex);if(input.data('selector'))input.data('selector').find('.miniColors-colors').css('backgroundColor','#'+hsb2hex({h:hsb.h,s:100,b:100}));if(input.data('change')){if(hex===input.data('lastChange'))return;input.data('change').call(input.get(0),'#'+hex,hsb2rgb(hsb));input.data('lastChange',hex);}};var setColorFromInput=function(input){input.val((input.val())?'#'+cleanHex(input.val()):'');var hex=expandHex(input.val());if(!hex)return false;var hsb=hex2hsb(hex);var currentHSB=input.data('hsb');if(hsb.h===currentHSB.h&&hsb.s===currentHSB.s&&hsb.b===currentHSB.b)return true;var colorPosition=getColorPositionFromHSB(hsb);var colorPicker=$(input.data('colorPicker'));colorPicker.css('top',colorPosition.y+'px').css('left',colorPosition.x+'px');input.data('colorPosition',colorPosition);var huePosition=getHuePositionFromHSB(hsb);var huePicker=$(input.data('huePicker'));huePicker.css('top',huePosition.y+'px');input.data('huePosition',huePosition);setColor(input,hsb);return true;};var convertCase=function(string,letterCase){if(letterCase==='lowercase')return string.toLowerCase();if(letterCase==='uppercase')return string.toUpperCase();return string;};var getColorPositionFromHSB=function(hsb){var x=Math.ceil(hsb.s/0.67);if(x<0)x=0;if(x>150)x=150;var y=150-Math.ceil(hsb.b/0.67);if(y<0)y=0;if(y>150)y=150;return{x:x-5,y:y-5};};var getHuePositionFromHSB=function(hsb){var y=150-(hsb.h/2.4);if(y<0)h=0;if(y>150)h=150;return{y:y-1};};var cleanHex=function(hex){return hex.replace(/[^A-F0-9]/ig,'');};var expandHex=function(hex){hex=cleanHex(hex);if(!hex)return null;if(hex.length===3)hex=hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];return hex.length===6?hex:null;};var hsb2rgb=function(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s===0){rgb.r=rgb.g=rgb.b=v;}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h===360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3;}
else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3;}
else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3;}
else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3;}
else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3;}
else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3;}
else{rgb.r=0;rgb.g=0;rgb.b=0;}}
return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)};};var rgb2hex=function(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length===1)hex[nr]='0'+val;});return hex.join('');};var hex2rgb=function(hex){hex=parseInt(((hex.indexOf('#')>-1)?hex.substring(1):hex),16);return{r:hex>>16,g:(hex&0x00FF00)>>8,b:(hex&0x0000FF)};};var rgb2hsb=function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;hsb.s=max!==0?255*delta/max:0;if(hsb.s!==0){if(rgb.r===max){hsb.h=(rgb.g-rgb.b)/delta;}else if(rgb.g===max){hsb.h=2+(rgb.b-rgb.r)/delta;}else{hsb.h=4+(rgb.r-rgb.g)/delta;}}else{hsb.h=-1;}
hsb.h*=60;if(hsb.h<0){hsb.h+=360;}
hsb.s*=100/255;hsb.b*=100/255;return hsb;};var hex2hsb=function(hex){var hsb=rgb2hsb(hex2rgb(hex));if(hsb.s===0)hsb.h=360;return hsb;};var hsb2hex=function(hsb){return rgb2hex(hsb2rgb(hsb));};switch(o){case'readonly':$(this).each(function(){if(!$(this).hasClass('miniColors'))return;$(this).prop('readonly',data);});return $(this);case'disabled':$(this).each(function(){if(!$(this).hasClass('miniColors'))return;if(data){disable($(this));}else{enable($(this));}});return $(this);case'value':if(data===undefined){if(!$(this).hasClass('miniColors'))return;var input=$(this),hex=expandHex(input.val());return hex?'#'+convertCase(hex,input.data('letterCase')):null;}
$(this).each(function(){if(!$(this).hasClass('miniColors'))return;$(this).val(data);setColorFromInput($(this));});return $(this);case'destroy':$(this).each(function(){if(!$(this).hasClass('miniColors'))return;destroy($(this));});return $(this);default:if(!o)o={};$(this).each(function(){if($(this)[0].tagName.toLowerCase()!=='input')return;if($(this).data('trigger'))return;create($(this),o,data);});return $(this);}}});})(jQuery);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);(function(csp,$,undefined){csp.comp={'social_media':{'facebook':function(data){$fb_like=$('<fb:like/>').attr({'href':data.url,'layout':'button_count','font':'lucida grande','show_faces':'false','send':'false','width':'200','id':'fb_like_comp'});$fb_span=$('<span/>').addClass('fb_wrapper');$('#comp_social_media').append($fb_span.append($fb_like));if(csp.share.facebook.script.loaded){FB.XFBML.parse(document.getElementById('comp_social_media'));}},'twitter':function(data){$tw_like=$('<a/>').attr({'href':'https://twitter.com/share','class':'twitter-share-button','data-url':data.url,'data-text':data.title,'data-count':'none','data-via':'CanStockPhoto','data-lang':data.lang,'rel':'nofollow'}).html('Tweet');$tw_span=$('<span/>').css({'position':'absolute','left':'160px'}).addClass('tw_wrapper');$('#comp_social_media').append($tw_span.append($tw_like));if(csp.share.twitter.script.loaded){twttr.widgets.load();}},'pinterest':{'script':{'callbacks':[],'loaded':false,'loading':false},'loaded':function(){this.script.loaded=true;for(var i=0;i<this.script.callbacks.length;i++){this.script.callbacks[i]();}},'load':function(callback){if(!this.script.loaded&&!this.script.loading){$.getScript(document.location.protocol+'//assets.pinterest.com/js/pinit.js',$.proxy(this.loaded,this));if(typeof callback!='undefined')this.script.callbacks.push(callback);this.script.loading=true;}else if(this.script.loading){if(typeof callback!='undefined')this.script.callbacks.push(callback);}else if(this.script.loaded){if(typeof callback!='undefined')callback();}},'add':function(data){$('#comp_social_media').append($('<a/>').html('<span style="position:absolute;left:320px;"><a href="http://www.pinterest.com/pin/create/button/?url='+encodeURI(location.href)+'&media=http://c450.canstockphoto.com/can-stock-photo_csp'+$('#photo_id').val()+'.jpg&description='+encodeURI($("#description").text())+'" data-pin-do="buttonPin" data-pin-config="beside" data-pin-color="white" rel="nofollow"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_white_20.png" /></a></span>'));this.load();}},'load':function(data){$('#comp_social_media').css({'position':'relative','padding-top':'10px'});if(csp.sm_live.facebook)this.facebook(data);if(csp.sm_live.twitter)this.twitter(data);if(csp.sm_live.pinterest)this.pinterest.add(data);}},'init':function(){}};$(document).ready(function(){csp.comp.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));var GLOBAL_TOTAL=0,GLOBAL_AGREED_SHOWING=false;function update_displayed_total(){GLOBAL_TOTAL=0;decimals=0;prefix='';surfix='';if($('input[name=size]:checked').val()=='13'||$('input[name=size]:checked').val()=='5'||$('input[name=size]:checked').val()=='7'||$('input[name=size]:checked').val()=='8'||$('input[name=size]:checked').val()=='9'||$('input[name=size]:checked').val()=='10'){$('#license_70').closest('div.newline').hide();$('#license_70').removeAttr('checked');}else{$('#license_70').closest('div.newline').show();}
$('input[name=size]:checked, input[name=other]:checked').each(function(){GLOBAL_TOTAL+=parseFloat($('#value_'+$(this).val()).val());});if($('#credits').val()>0){surfix=' '+$('#currency').html();checkbox_display(GLOBAL_TOTAL<=$('#credits').val());}else if($('#currency').html()=='USD'){checkbox_display(GLOBAL_TOTAL==0);prefix='$';decimals=2;}else{checkbox_display(GLOBAL_TOTAL==0);prefix=$('#currency_leading_symbol').val();surfix=$('#currency_trailing_symbol').val();decimals=2;}
total_str=GLOBAL_TOTAL.toFixed(decimals).toString();if(decimals>0){temp_total=total_str.substr(0,total_str.length-(decimals+1));temp_total+=$('#lang_decimal_symbol').val();temp_total+=total_str.substr(total_str.length-decimals);total_str=temp_total;}
$('#total').html(prefix+total_str+surfix);$('#credits-total').html(GLOBAL_TOTAL);temp_total=GLOBAL_TOTAL/2;$('#discount-total').html(prefix+temp_total.toFixed(2).toString());}
function checkbox_display(show){if(show){$('#agree_license').slideDown(200);$('#total').css({'color':'black'});GLOBAL_AGREED_SHOWING=true;}else{$('#agree_license').slideUp(200);$('#total').css({'color':'red'});GLOBAL_AGREED_SHOWING=false;}}
function highlight_selected(sel_name){$('input[name='+sel_name+']').closest('.newline').removeClass('pricing_selected');$('input[name='+sel_name+']:checked').closest('.newline').addClass('pricing_selected');update_displayed_total();}
function submit_order(){var photo_id=$('#photo_id').val();$('#agree_license').slideUp(200);var ITEMS=new Array();$('input[name=size]:checked, input[name=other]:checked').each(function(){var product_id=$(this).val();_gaq.push(['_trackEvent','download_button_click',product_id,photo_id]);ITEMS.push({'product_id':product_id,'photo_id':photo_id});});if(GLOBAL_AGREED_SHOWING){download_ajax(ITEMS);}else{$('#download_button').empty().append('<img src="'+GLOBAL_STATIC_HOST+'/img/l1.gif"'+'/>');add_cart_ajax(ITEMS);if($('#credits').val()>0){popup_alert_ajax('notEnoughCredits-cartInstead');}}}
function popup_alert_ajax(msg_tag){file_view_ajax({funct:'popup_alert_ajax',msg_tag:msg_tag},function(data){if(data.success&&data.msg!=''){alert(data.msg);}},'file_view_ajax');}
function download_ajax(ITEMS){$('#download_button').hide();file_view_ajax({items:ITEMS,funct:'download_file_ajax'},download_ajax_callback,'file_view_ajax');}
function download_ajax_callback(data){file='download_modal';path='includes';ext='php';if(data.success){if(data.resize){image_resize(data.pid,data.tid,data.size);}else{if(data.error||data.download_error){$(window).cspPopup({html:'<p style="color:red;font-size:1.5em;font-weight:bold;">'+data.msg+'</p>'}).show();}else{$(window).cspPopup({href:'/'+path+'/'+file+'.'+ext+'?photo_id='+data.pid+'&tid='+data.tid,onhide:function(){$('#download_button').show();},onshow:function(){if($(window).data('dl_error')){$('#wait_msg').css({'color':'IndianRed','font-weight':'bold'}).html($(window).data('dl_error'));}}}).show();}
if(!data.error&&!data.download_error){RESPONSE_ie=data.ie;check_download(data);}}}}
function image_resize(pid,tid,size){ext='php';path='resizer';$('#download_button').html('');file='resize';$(window).cspPopup({'href':'/'+path+'/'+file+'.'+ext+'?pid='+pid+'&tid='+tid+'&size='+size}).show();}
function check_download(data){data['funct']='poll_download';data['success']=true;data['ready']=false;$.ajax({url:'/file_view_ajax.php',dataType:'json',type:'POST',data:data,success:poll_download,error:function(){setTimeout(function(){poll_download(data)},3000);}});}
function poll_download(data){if(data.success){if(!data.ready){check_download(data);}else{$('#ie-error').show();dl_url='http://'+data.site+'/'+'retrieve'+'.'+'php?trans='+data.tid+'&photo_id='+data.pid+'&extension='+data.extension+"&unique_id="+data.unique_id;$('#download_msg a').attr('href',dl_url);if(!RESPONSE_ie){window.location=dl_url;}
$('.download_ready_show').show();$('.download_ready_hide').hide();$(window).cspPopup().resize();}}else{$('#wait_msg').html(data.msg);}}
function add_cart_ajax(ITEMS){$('.cart_link').show();file_view_ajax({'items':ITEMS,'funct':'add_cart_ajax'},function(data){if(data.success){if(data.take_to_cart){window.location='/cart.php';}else{$('#download_button, #q_download_area').html(data.msg);}}},'file_view_ajax');fly_to_cart();}
function file_view_ajax(data,success,t_file){t_ext='php';$.ajax({url:'/'+t_file+'.'+t_ext,type:'POST',dataType:'json',data:data,success:success});}
function credit_message_click(){_gaq.push(['_trackEvent','credit_message_click','click','click']);cspgoto('','purchase_credits','','php',null,0,0);}
function fly_to_cart(){var $carts=$('span.cart-header, span.cart-footer');$carts.slideDown(400);var productX=$('.comp').offset().left;var productY=$('.comp').offset().top;var cartX=$('span.cart-footer').offset().left-$('span.cart-footer').width();var cartY=$('span.cart-footer').offset().top;var gotoX=cartX-productX;var gotoY=cartY-productY;var newImageWidth=$('.comp').width()/3;var newImageHeight=$('.comp').height()/3;var numCart=parseInt($('span.cart-footer span.cart-num').html())+1;$('#main-zoom-view').clone().prependTo('#comp_l_area').css({'position':'absolute','left':productX+'px','zIndex':200000}).animate({opacity:0.5,marginLeft:gotoX,marginTop:gotoY,width:newImageWidth,height:newImageHeight},800,function(){$carts.addClass('flash');$carts.find('span.cart-num').html(numCart);if(numCart==1){$carts.find('span.cart-sing').show();$carts.find('span.cart-mult').hide();}else{$carts.find('span.cart-sing').hide();$carts.find('span.cart-mult').show();}
setTimeout('$("span.cart-header, span.cart-footer").removeClass("flash");',100);$(this).remove();});}
function set_notice_box_widths(){$('#set_warning, #signup_now').each(function(index){$(this).width($(this).children('span').width()+10);});}
$(document).ready(function(){set_notice_box_widths();$('#toggle_other').live('click',function(){$('#toggle_other').fadeOut(200,function(){$('#other').slideDown(200);_gaq.push(['_trackEvent','view_options','clicked','view licensing and other options clicked']);});});$('#toggle_pixels, #toggle_inches, #toggle_cm').live('click',function(){if($(this).attr('id')=='toggle_pixels'){$("#toggle_inches").addClass('alookalike');$("#toggle_cm").addClass('alookalike');$('#toggle_pixels').removeClass('alookalike');$('#toggle_pixels').removeClass('alookalike-hover');$(".inches, .cm").hide();$('.pixels').fadeIn(200);}else if($(this).attr('id')=='toggle_inches'){$("#toggle_pixels").addClass('alookalike');$("#toggle_cm").addClass('alookalike');$('#toggle_inches').removeClass('alookalike');$('#toggle_inches').removeClass('alookalike-hover');$(".pixels, .cm").hide();$('.inches').fadeIn(200);}else if($(this).attr('id')=='toggle_cm'){$("#toggle_inches").addClass('alookalike');$("#toggle_pixels").addClass('alookalike');$('#toggle_cm').removeClass('alookalike');$('#toggle_cm').removeClass('alookalike-hover');$(".inches, .pixels").hide();$('.cm').fadeIn(200);}});$('.toggle').live('mouseover mouseout',function(event){if(event.type=='mouseover'){$(this).addClass('pricing_hover');}else{$(this).removeClass('pricing_hover');}});$('.toggle').live('click',function(){if($(this).hasClass("pricing_selected")){$(this).find('input').removeAttr("checked");}else{$(this).find('input:not(:disabled)').attr('checked','checked');}
highlight_selected($(this).find('input').attr('name'));});$('#download_click').live('mouseover mouseout',function(event){if(event.type=='mouseover'){$(this).attr('src',$(this).attr('src').replace('button1','button2'));}else{$(this).attr('src',$(this).attr('src').replace('button2','button1'));}});$('#download_button span.alookalike').live('click',function(){if(GLOBAL_AGREED_SHOWING&&!$('#i_accept').is(':checked')){popup_alert_ajax('mustAgreeLicenseTerms');}else{submit_order();}});selected=$('#size_3, #size_5, #size_8').attr('checked',true);highlight_selected('size');$('.alookalike').live('mouseover mouseout',function(event){if(event.type=='mouseover'){$(this).addClass('alookalike-hover');}else{$(this).removeClass('alookalike-hover');}});});function open_print_modal(photo_id,image_ratio){$(window).cspPopup({href:'/includes/print_modal.php?id='+photo_id+'&ratio='+image_ratio}).show();_gaq.push(['_trackEvent','print_modal','opened',photo_id]);}
$('.fb_wrapper').on("click",function(){$(".fb_edge_widget_with_comment").css("z-index","5000");alert('ran');});function related_images(data){var t_ext='php',t_file='file_view_ajax';for(var x=0;x<data.length;x++){var row=data[x];$.ajax({'url':'/'+t_file+'.'+t_ext,'type':"POST",'dataType':"html",'data':row,'success':$.proxy(function(data){if(data!=''){$(this).show().append(data);}},$('#'+row.id))});}}
function grouped_related_images(photo_id){var t_ext='php',t_file='file_view_ajax';$.ajax({'url':'/'+t_file+'.'+t_ext,'type':'POST','dataType':'html','data':{'funct':'grouped_related_images','photo_id':photo_id},'success':function(html){$('#more').html(html);}});}
var GLOBAL_TOTAL=0,GLOBAL_AGREED_SHOWING=false;function q_update_displayed_total(){GLOBAL_TOTAL=0;decimals=0;prefix='';surfix='';$('input[name=size]:checked, input[name^="license"]:checked').each(function(){GLOBAL_TOTAL+=parseFloat($('#value_'+$(this).val()).val());});if($('#credits').val()>0){surfix=' '+$('#currency').html();q_checkbox_display(GLOBAL_TOTAL<=$('#credits').val());}else if($('#currency').html()=='USD'){q_checkbox_display(GLOBAL_TOTAL==0);prefix='$';decimals=2;}else{q_checkbox_display(GLOBAL_TOTAL==0);prefix=$('#currency_leading_symbol').val();surfix=$('#currency_trailing_symbol').val();decimals=2;}
total_str=GLOBAL_TOTAL.toFixed(decimals).toString();if(decimals>0){temp_total=total_str.substr(0,total_str.length-(decimals+1));temp_total+=$('#lang_decimal_symbol').val();temp_total+=total_str.substr(total_str.length-decimals);total_str=temp_total;}
$('#total').html(prefix+total_str+surfix);}
function q_checkbox_display(show){if(show){$('#total').css({'color':'black'});GLOBAL_AGREED_SHOWING=true;}else{if($('#credits').val()>0){$('#total').css({'color':'red'});}else{$('#total').css({'color':'black'});}
GLOBAL_AGREED_SHOWING=false;}}
function q_highlight_selected(sel_name){$('input[name='+sel_name+']').closest('.q_newline').removeClass('q_pricing_selected');$('input[name='+sel_name+']:checked').closest('.q_newline').addClass('q_pricing_selected');q_update_displayed_total();}
function q_submit_order(){$(".popover").hide();var photo_id=$('#photo_id').val();var ITEMS=new Array();$('input[name=size]:checked, input[name^="license"]:checked').each(function(){var product_id=$(this).val();_gaq.push(['_trackEvent','download_button_click',product_id,photo_id]);ITEMS.push({'product_id':product_id,'photo_id':photo_id});});if($(".step1_button").length>0&&$('#total').css('color')!='rgb(255, 0, 0)'){download_ajax(ITEMS);}else{$('#q_download_area').empty().append('<img src="'+GLOBAL_STATIC_HOST+'/img/l1.gif"'+'/>');add_cart_ajax(ITEMS);if($('#total').css('color')=='rgb(255, 0, 0)'){popup_alert_ajax('notEnoughCredits-cartInstead');}}}
function setup_comp(){selected=$('#size_3, #size_5, #size_8').attr('checked',true);q_highlight_selected('size');$('div.q_newline').tooltip({'selector':'','placement':'left'});$('#q_size_head div.q_size span').tooltip({'selector':'','placement':'top'});$('#q_download_area input').popover({'placement':'right','animation':false});$('.q_toggle').hover(function(){$(this).addClass('pricing_hover');},function(){$(this).removeClass('pricing_hover');});$('.q_toggle').on('click',function(){if($(this).hasClass("q_pricing_selected")){$(this).find('input:not(:disabled)').prop('checked',false);;}else{$(this).find('input:not(:disabled)').prop('checked',true);}
q_highlight_selected($(this).find('input').attr('name'));});$('#toggle_pixels, #toggle_inches, #toggle_cm').on('click',function(){if($(this).attr('id')=='toggle_pixels'){$("#toggle_inches").addClass('alookalike');$("#toggle_cm").addClass('alookalike');$('#toggle_pixels').removeClass('alookalike');$('#toggle_pixels').removeClass('alookalike-hover');$(".inches, .cm").hide();$('.pixels').fadeIn(200);}else if($(this).attr('id')=='toggle_inches'){$("#toggle_pixels").addClass('alookalike');$("#toggle_cm").addClass('alookalike');$('#toggle_inches').removeClass('alookalike');$('#toggle_inches').removeClass('alookalike-hover');$(".pixels, .cm").hide();$('.inches').fadeIn(200);}else if($(this).attr('id')=='toggle_cm'){$("#toggle_inches").addClass('alookalike');$("#toggle_pixels").addClass('alookalike');$('#toggle_cm').removeClass('alookalike');$('#toggle_cm').removeClass('alookalike-hover');$(".inches, .pixels").hide();$('.cm').fadeIn(200);}});}
(function(csp,$,undefined){csp.search=csp.search||{};csp.search.default_params={'types':[],'rmode':'normal','rows':75,'start':0,'content':1,'display':'grd','sort':1,'exclude':'','copyspace':'','colors':'','artist':'','debug':false,'extra':null};csp.search.current_params={};csp.search.initial_params=null;csp.search.loading_params=null;csp.search.display_params=null;csp.search.get_params=function(){return $.extend({},csp.search.default_params,csp.search.current_params);};csp.search.load={'loading':{},'results':{},'last_request':null,'is_loading':function(start){return(this.loading.hasOwnProperty(start)&&this.loading[start]);},'is_loaded':function(start){return(this.results.hasOwnProperty(start)&&this.results[start].results.length>0);},'preload':function(){var params=csp.search.get_params();params.start=params.start+params.rows;if(params.num_results>0)this.update_process(params);},'update':function(params){var ignore=['en_term','forced_filter','num_results','page','start'],diff=csp.search.compare.diff(csp.search.get_params(),params,ignore,'update');if(!$.isEmptyObject(diff)){params.start=0;params.page=1;this.results={};this.loading={};}
csp.search.display.loading();csp.search.display_params=params;this.update_process(params);},'update_process':function(params){if(!this.is_loading(params.start)&&!this.is_loaded(params.start)){this.loading[params.start]=true;if(params.num_results==null||params.num_results==0||params.start<params.num_results){csp.search.loading_params=params;if(this.last_request!==null)this.last_request.abort();this.last_request=$.cspAjax({'url':'/search_ajax.php?term='+encodeURIComponent(params.term)+'&start='+params.start,'success':$.proxy(this.process,this),'dataType':'json','data':{'funct':'search_ajax','params':JSON.stringify(params)},'type':'POST','async':true});}}else if(!this.is_loading(params.start)){csp.search.results.container.trigger('csp_results_loaded',this.results[params.start]);}},'cleanup':function(){var params=csp.search.get_params();for(var offset in this.results){if(this.results.hasOwnProperty(offset)&&(offset>(params.start+(params.rows*4))||offset<(params.start-(params.rows*3)))){delete this.results[offset];delete this.loading[offset];}}},'process':function(data){this.last_request=null;if(data.success){if(csp.search.compare.same(csp.search.loading_params,data.params,'load_process')){csp.search.loading_params=null;}
this.results[data.details.start]={'results':csp.search.build.process_data(data,data.params.display),'related':data.related,'params':data.params,'details':data.details};this.loading[data.details.start]=false;csp.search.results.container.trigger('csp_results_loaded',this.results[data.details.start]);this.cleanup();}}};csp.search.initial={'init':function(params){csp.search.current_params=params;csp.search.default_params.term=params.term;csp.search.initial_params=$.extend({},csp.search.default_params,csp.search.current_params);csp.search.filters.search_types.types=csp.search.current_params.types;csp.search.filters.search_types.update();if(!csp.search.hash.change()){csp.search.results.container.trigger('results_displayed',{'params':csp.search.current_params});}else{csp.search.results.container.trigger('initiate_params',csp.search.loading_params);}
if(csp.search.current_params.rows==76){csp.search.current_params.rows=csp.search.results.container.find('div.img_container:fully_visible').length;csp.search.results.container.find('div.img_container').not(':fully_visible').remove();$('#next_button').hide();}}};csp.search.display={'scrollTop':function(){$(window).scrollTop(120);},'loading':function(){csp.search.results.loading.start();},'details':function(details){if($(window).scrollTop()>120)this.scrollTop();$('div.search_nav span.num_pages').html(details.num_pages.f);$('div.search_nav span.num_images').html(details.num_results.f);$('#search_page h1').html(details.h1.f);document.title=details.h1.v;csp.search.filters.update();csp.search.navigation.update();csp.search.display_filters.update();csp.search.hash.update();$('#search_term').val($("#sidebar_term").val());},'load_process':function(data){csp.search.current_params=data.params;_gaq.push(['_trackPageview','/csp/search.php?term='+data.params.term+'&start='+data.params.start]);csp.search.navigation.next_button.detach();csp.search.navigation.next_button_grid.detach();csp.search.results.container.empty();csp.search.results.display_none(data.results.length==0,data.params.term);for(var i=0;i<data.results.length;i++){csp.search.results.container.append(data.results[i]);}
csp.search.results.container.removeClass(function(index,css){return(css.match(/(^|\s)results-\S+/g)||[]).join(' ');})
csp.search.results.container.addClass('results-'+csp.search.display_params.display);csp.search.results.container.trigger('results_displayed',{'params':csp.search.current_params});$(document).trigger('images_displayed');csp.search.results.container.append(csp.search.navigation.next_button,csp.search.navigation.next_button_grid);csp.search.results.loading.end();this.details(data.details);csp.search.load.preload();$.cookie('pg_views',(parseInt($.cookie('pg_views')||0)+1),{'path':'/'});},'load':function(event,data){if(csp.search.compare.same(csp.search.display_params,data.params,'display_load')){this.load_process(data);}},'init':function(){csp.search.results.container.bind('csp_results_loaded',$.proxy(this.load,this));}};csp.search.navigation={'timeout':null,'update':function(){var params=csp.search.get_params();this.buttons.css({'opacity':1,'visibility':'visible'});csp.search.navigation.next_button_grid.removeClass('hide');this.buttons.show();if(params.start<=0)this.buttons.filter('.back_page').css('visibility','hidden');if(params.start+params.rows>=params.num_results){this.buttons.filter('.next_page').css('visibility','hidden');csp.search.navigation.next_button_grid.addClass('hide');}
this.input.val(parseInt(params.start/params.rows)+1);},'forward':function(){var params=csp.search.get_params();params.start=parseInt(params.start)+parseInt(params.rows);if(params.start<params.num_results){this.buttons.filter('.next_page').css('opacity',0.5);csp.search.load.update(params);}},'backward':function(){var params=csp.search.get_params();params.start=parseInt(params.start)-parseInt(params.rows);if(params.start>=0){this.buttons.filter('.back_page').css('opacity',0.5);csp.search.load.update(params);}},'page':function(event){window.clearTimeout(this.timeout);if($(event.target).hasClass('next_page')){this.forward();}else{this.backward();}},'jump_process':function(){var params=csp.search.get_params();params.start=((parseInt(this.input.val())-1)*params.rows);if(params.start<0){params.start=0;}else if(params.start>params.num_results){var left_over=(params.num_results%params.rows);params.start=params.num_results-((left_over>0)?left_over:params.rows);}
csp.search.load.update(params);},'jump':function(event){window.clearTimeout(this.timeout);if(event.keyCode==13){this.jump_process();}else{this.timeout=window.setTimeout($.proxy(this.jump_process,this),750);this.input.val($(event.target).val().replace(/[^0-9]/g,''));}},'keyboard_page':function(event){if(event.keyCode==39){this.forward();}else if(event.keyCode==37){this.backward();}},'nbutton':function(){var params=csp.search.get_params();if(params.start+params.rows<params.num_results&&params.rows>0){var result_container_width=csp.search.results.container.find('div.img_container').outerWidth(true),search_results_columns=Math.floor(csp.search.results.container.width()/result_container_width),result_count=csp.search.results.container.find('div.img_container').length,result_remainder=(result_count%search_results_columns);if(result_remainder>0){var nbutton_width=(((search_results_columns-result_remainder)*result_container_width)-10);this.next_button.width(nbutton_width);this.next_button.find('img.tail').width(Math.floor(nbutton_width*.5));this.next_button.removeClass();}}},'init':function(){$(document).keydown($.proxy(this.keyboard_page,this));this.buttons=$('div.search_nav span.next_page, div.search_nav span.back_page');this.buttons.click($.proxy(this.page,this));this.next_button=$('#next_button');this.next_button.click($.proxy(this.forward,this));this.next_button_grid=$('div.grid-next');this.next_button_grid.on('click',$.proxy(this.forward,this));this.input=$('div.search_nav input.current_page');var jump=$.proxy(this.jump,this);this.input.keyup(jump).blur(jump);this.update();this.nbutton();csp.search.results.container.bind('results_displayed',$.proxy(this.nbutton,this));$(window).resize($.proxy(this.nbutton,this));}};csp.search.display_filters={'display':{'change':function(event){var params=csp.search.get_params();params.display=$(event.target).val();this.input.val(params.display);csp.search.load.update(params);},'init':function(){this.input=$('select.display');this.input.change($.proxy(this.change,this));},'update':function(){this.input.val(csp.search.current_params.display);}},'sort':{'change':function(event){var params=csp.search.get_params();params.sort=$(event.target).val();this.input.val(params.sort);csp.search.load.update(params);},'init':function(){this.input=$('select.sort');this.input.change($.proxy(this.change,this));},'update':function(){this.input.val(csp.search.current_params.sort);}},'rows':{'clean_rows':function(rows){switch(rows){case 25:case 50:case 75:case 100:case 200:return rows;default:return-1;}},'change_process':function(rows){var params=csp.search.get_params();params.rows=rows;var remainder=(params.start%params.rows);if(remainder!==0)params.start-=remainder;csp.search.load.update(params);},'change':function(event){var rows=this.clean_rows(parseInt($(event.target).val()));if(rows==-1){rows=csp.search.results.container.find('div.img_container:fully_visible').length;this.change_process(rows);csp.search.display.scrollTop();this.bottom_nav.hide();}else{this.change_process(rows);this.bottom_nav.show();}
this.input.val(rows);},'init':function(){this.input=$('select.num_results');this.input.change($.proxy(this.change,this));this.bottom_nav=$('#search_nav2');},'update':function(){this.input.val(this.clean_rows(csp.search.current_params.rows));}},'update':function(){this.display.update();this.sort.update();this.rows.update();},'init':function(){this.display.init();this.sort.init();this.rows.init();}};csp.search.filters={'content':{'change':function(){var params=csp.search.get_params();params.content=parseInt(this.input.val());csp.search.load.update(params);},'init':function(){this.input=$('#sidebar_filter');this.input.change($.proxy(this.change,this));},'update':function(){this.input.val(csp.search.current_params.content);}},'orientation':{'change':function(){var params=csp.search.get_params();params.orientation=this.input.val();if(params.orientation==0){delete params['orientation']}
csp.search.load.update(params);},'init':function(){this.input=$('#sidebar_orientation');this.input.change($.proxy(this.change,this));},'update':function(){this.input.val(csp.search.current_params.orientation);}},'exclude':{'timeout':null,'process':function(){var params=csp.search.get_params();if(this.input.val()!=params.exclude){params.exclude=this.input.val();csp.search.load.update(params);}},'change':function(event){window.clearTimeout(this.timeout);if(event.keyCode==13){this.process();}else{this.timeout=window.setTimeout($.proxy(this.process,this),750);}},'init':function(){this.input=$('#sidebar_exclude');var input_change=$.proxy(this.change,this);this.input.keyup(input_change).blur(input_change).focus(input_change);},'update':function(){this.input.val(csp.search.current_params.exclude);}},'search_term':{'timeout':null,'process':function(){var params=csp.search.get_params();if(this.input.val()!=params.term){params.term=this.input.val();csp.search.load.update(params);}},'change':function(event){window.clearTimeout(this.timeout);if(event.keyCode==13){this.process();}else{this.timeout=window.setTimeout($.proxy(this.process,this),750);}},'init':function(){this.input=$('#sidebar_term');var input_change=$.proxy(this.change,this);this.input.keyup(input_change).blur(input_change).focus(input_change);},'update':function(){}},'search_types':{'types':[],'in_types':function(key){return $.inArray(key,this.types)!=-1},'store_types':function(idx,elem){this.types.push(parseInt($(elem).val()));},'clean':function(){if(this.in_types(0)){this.types=[];}else{if(this.in_types(1)&&this.in_types(2)&&this.in_types(5)&&!this.in_types(4)){this.types=[];}else{var idx_2=$.inArray(2,this.types);if(this.in_types(4)&&idx_2!=-1){this.types.splice(idx_2,1);}else if(this.in_types(2)){this.types.push(4);}}}},'display_update':function(types){this.inputs.removeAttr('checked');if(types.length==0){$('#sidebar_type_all').attr({'disabled':'disabled','checked':'checked'});}else{$('#sidebar_type_all').removeAttr('disabled');for(var i=0;i<types.length;i++){$('#sidebar_type_'+types[i]).attr('checked','checked');}}
if($.inArray(2,types)!=-1||$.inArray(4,types)!=-1){$('#sidebar_type_vectors_only').show();if($.inArray(2,types)==-1){$('#sidebar_type_2').attr('checked','checked');}else{$('#sidebar_type_4').removeAttr('checked');}}else{$('#sidebar_type_vectors_only').hide();}
$('#sidebar').trigger('resize');},'change':function(event){this.types=[];if(!$(event.target).is(':checked')&&$(event.target).val()==2){$('#sidebar_type_4').removeAttr('checked');}
this.inputs.filter(':checked').not(':disabled').each($.proxy(this.store_types,this));this.clean();this.display_update(this.types);var params=csp.search.get_params();if(!csp.search.compare.same(this.types,params.types,'filter_change')){params.types=this.types;csp.search.load.update(params);}},'init':function(){this.inputs=$('#sidebar input[name="search_type"]');this.inputs.change($.proxy(this.change,this));},'update':function(){this.display_update(csp.search.current_params.types);}},'update':function(){this.search_term.update();this.search_types.update();this.orientation.update();this.content.update();this.exclude.update();},'init':function(){this.search_term.init();this.search_types.init();this.orientation.init();this.content.init();this.exclude.init();}};csp.search.results={'container':null,'none_container':null,'loading':{'start':function(){csp.search.results.container.css('opacity',0.5);},'end':function(){csp.search.results.container.css('opacity',1);}},'display_none':function(none,phrase){if(none){csp.search.results.none_container.find('i.term').html(phrase);csp.search.results.search_page_container.hide();csp.search.results.none_container.show();}else{csp.search.results.search_page_container.show();csp.search.results.none_container.hide();}},'init':function(){this.container=$('#search_results');this.none_container=$('#no_results');this.search_page_container=$('#search_page');}};csp.search.preload={'load':function(){if(($(document).height()-$(window).height())<275){csp.search.load.preload();}else{$(window).scroll($.proxy(this.scroll,this));}},'scroll':function(){if($(window).scrollTop()>100){csp.search.load.preload();}}};csp.search.init=function(){csp.search.results.init();csp.search.display.init();csp.search.display_filters.init();csp.search.navigation.init();csp.search.filters.init();};$(document).ready(function(){csp.search.init();});$(window).load(function(){csp.search.preload.load();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.compare={'debug':false,'ignore':function(key,ignore){return(ignore!==undefined&&$.inArray(key,ignore)!=-1);},'diff_process':function(obj1_t,obj2_t,diff,ignore){var diff=diff||{};var ignore=ignore||[];var obj1=obj1_t.values;var obj2=obj2_t.values;for(var key in obj1){if(obj1.hasOwnProperty(key)&&!this.ignore(key,ignore)){if(obj1!==null&&typeof(obj1[key])=='object')obj1[key]=JSON.stringify(obj1[key]);if(obj2!==null&&typeof(obj2[key])=='object')obj2[key]=JSON.stringify(obj2[key]);if(obj2===null||!obj2.hasOwnProperty(key)||obj1[key]!=obj2[key]){if(diff[key]==undefined)diff[key]={};diff[key][obj1_t.tag]=obj1[key];diff[key][obj2_t.tag]=(obj2!==null&&obj2.hasOwnProperty(key))?obj2[key]:null;}}}
return diff;},'diff':function(obj1o,obj2o,ignore,tag){var diff={},obj1=$.extend({},obj1o),obj2=$.extend({},obj2o),tag=tag||'';this.diff_process({'values':obj1,'tag':'obj1'},{'values':obj2,'tag':'obj2'},diff,ignore);this.diff_process({'values':obj2,'tag':'obj2'},{'values':obj1,'tag':'obj1'},diff,ignore);if(this.debug){console.groupCollapsed('compare: ',tag);console.log(JSON.stringify(diff));console.groupEnd();}
return diff;},'same':function(obj1,obj2,tag){return $.isEmptyObject(this.diff(obj1,obj2,['num_results','en_term'],tag));}};}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.hash={'comp_regex':/file_view\.php\?id=([0-9]+)/,'last_hash':'','comp_redirect':function(){if(this.comp_regex.test(window.location.hash)){window.location.replace('http://'+csp.domain+'/'+window.location.hash.replace('#',''));}},'search_params':function(){var hash_params_raw=this.last_hash.replace('#','').split(/[\||;]/),params=[];for(var i=0;i<hash_params_raw.length;i++){var param=hash_params_raw[i].split(':');params[param[0]]=(!isNaN(param[1])&&param[1]!=='')?parseInt(param[1]):decodeURI(param[1]);if(param[0]=='types'){params[param[0]]=JSON.parse(params[param[0]]);}}
return params;},'change':function(event){if(window.location.hash!==this.last_hash){this.last_hash=window.location.hash;if(this.comp_regex.test(this.last_hash)){var matches=this.last_hash.match(this.comp_regex);csp.search.comp.load(matches[1]);return true;}else{csp.search.comp.hide();if(this.last_hash){var hash_params=$.extend({},csp.search.get_params(),this.search_params());}else{var hash_params=$.extend({},csp.search.initial_params);}
if(!csp.search.compare.same(hash_params,csp.search.get_params(),'hash_change')){csp.search.load.update(hash_params);return true;}}}
return false;},'update':function(){var ignore=['debug','en_term','extra','forced_filter','num_results','page'];var diff=csp.search.compare.diff(csp.search.get_params(),csp.search.default_params,ignore,'hash_update');var hash_params=[];for(var key in diff){if(diff.hasOwnProperty(key)){hash_params.push(key+':'+diff[key]['obj1']);}}
if(!(window.location.hash==''&&hash_params.length==0)){window.location.hash=hash_params.join(';');}},'init':function(){this.comp_redirect();$(window).hashchange($.proxy(this.change,this));}};$(document).ready(function(){csp.search.hash.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.build={'process_data':function(data,display){var debug=(csp.search.debug.debug_active&&data.debug!==undefined),return_results=[];for(x in data.results){var result=data.results[x];if(typeof(result.photo_id)!='undefined'){if(debug){result.debug=data.debug.explain[result.photo_id];result.debug_term=data.params.term;}
result.img=this.create_image(result.photo_id,display,result.imagetype,result.ratio);var row=this[display](result);return_results.push(row);}}
return return_results;},'profile_anchor':function(username){return $('<a/>').attr({'href':'http://'+csp.domain+'/'+username,'title':'View '+username+'\'s Profile'}).html(username);},'comp_url':function(id){return'http://'+csp.domain+'/file_view.php?id='+id;},'img_domains':{'xl':'http://cdn.xl.thumbs.canstockphoto.com/','l':'http://l.thumbs.canstockphoto.com/','m':'http://m.thumbs.canstockphoto.com/'},'ie9_bug_fix':function(event){$(event.target).removeAttr('width').removeAttr('height');},'create_image':function(photo_id,display,imagetype,ratio){var $img=$(new Image()).addClass('thumb-hover');var prefix=((display=='grd')?'xl':(display=='sml')?'m':'l');$img.attr({'data-id':photo_id,'data-ratio':ratio});if($.browser.msie)$img.load($.proxy(this.ie9_bug_fix,this));$img.attr('src',this.img_domains[prefix]+'canstock'+photo_id+'.jpg')
if(imagetype==5)$img.addClass('thumb-mov');var $container=$('<span class="thumb-container" />').append($img);return $container},'base':function(result){var items={'link':$('<a/>').attr('href',this.comp_url(result.photo_id)).append(result.img)};if(result.imagetype=='5'&&result.video_format){items['link'].addClass('video-'+result.video_format.toLowerCase());}
items['container']=$('<div/>').data('id',result.photo_id).addClass('img_container').append(items['link']);return items;},'add_extra':function(container,result){if(csp.search.debug.debug_active){container.append(csp.search.debug.debug_output(result));container.append(csp.search.debug.output_html_data(result,'sds'));container.append(csp.search.debug.output_html_data(result,'ctr'));}
return container;},'tit':function(result){return this.reg(result);},'reg':function(result){var base=this.base(result),title=$('<span/>').addClass('titl').html(result.title);base['link'].append(title);return this.add_extra(base['container'],result);},'gal':function(result){var base=this.base(result);return this.add_extra(base['container'],result);},'sml':function(result){var base=this.base(result);return this.add_extra(base['container'],result);},'grd':function(result){var base=this.base(result);base['link'].find('span.thumb-container').append($('<span/>').addClass('thumb-mask'));return this.add_extra(base['container'],result);},'det':function(result){var base=this.base(result),title=$('<span/>').addClass('titl').html(result.title),details_str='<br>'+result.downloads+' DLs / '+result.views+' VWs',details=$('<div/>').addClass('username').append('by ',this.profile_anchor(result.username),details_str);base['link'].append(title);return this.add_extra(base['container'].append(details),result);}};}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.comp={'search_data':{'title':null,'top':null},'loaded':{'photo_id':null,'showing':false},'container':null,'search_container':null,'last_request':null,'show_content':function(){this.container.show().html(this.loaded.content);csp.search.results.loading.end();$('body').css('cursor','auto');$('a').css('cursor','pointer');$('#size_3, #size_5, #size_8').attr('checked','checked');highlight_selected('size');set_notice_box_widths();this.loaded.showing=true;$.cookie('pg_views',(parseInt($.cookie('pg_views')||0)+1),{'path':'/'});},'show':function(){if(!this.loaded.showing){window.location.hash='file_view.php?id='+this.loaded.photo_id;$(window).scrollTop(0);document.title=this.loaded.page_title;this.search_container.hide();this.show_content();}},'hide':function(){if(this.loaded.showing){this.container.hide();this.search_container.show();$(window).scrollTop(this.search_data.top);document.title=this.search_data.title;this.loaded.showing=false;}},'load_process':function(data){this.loaded=data;this.show();},'load':function(photo_id){if(this.loaded.photo_id==photo_id){this.show();}else{$('body, a').css('cursor','progress');csp.search.results.loading.start();if(this.last_request!==null)this.last_request.abort();this.last_request=$.cspAjax({'url':'/file_view.php?id='+photo_id+'&search','success':$.proxy(this.load_process,this),'dataType':'json','type':'POST','async':true});}},'view':function(photo_id){this.load(photo_id);this.search_data.top=$(window).scrollTop();this.search_data.title=document.title;},'click':function(event){var $elem=$(event.target).closest('div.img_container').find('img.thumb-hover');var photo_id=$elem.data('id');if(typeof(photo_id)!='undefined'){$('body').trigger('close_preview');event.preventDefault();event.stopPropagation();this.view(photo_id);return false;}
return true;},'view_comp_page':function(event,data){$('body').trigger('close_preview');if(typeof(data.photo_id)!='undefined'){this.view(data.photo_id);}},'comp_link_click':function(event){if(this.container.length>0){$('body').trigger('close_preview');var photo_id=$(event.target).data('id');if(typeof(photo_id)!='undefined'){event.preventDefault();event.stopPropagation();this.view(photo_id);return false;}}
return true;},'bind':function(){csp.search.results.container.on('click','div.img_container',$.proxy(this.click,this));$('body').on('click','div.pv_inner a',$.proxy(this.comp_link_click,this));$('body').bind('view_comp_page',$.proxy(this.view_comp_page,this));},'init':function(){this.container=$('#file_view');this.search_container=$('#search_page_contents');this.bind();}};$(document).ready(function(){csp.search.comp.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.tracking={'debug':false,'params':{},'previewed_index':[],'viewed_index':[],'impressions':[],'previewed':[],'viewed':[],'push':function(array,value){if(array instanceof Array){if($.inArray(value,array)==-1){array.push(value);}}},'init':function(){this.track.init();$(window).unload($.proxy(this.store,this));var parse=$.proxy(this.track.impressions.parse_visible,this.track.impressions);$('#search_results').bind('results_displayed',parse);},'clear':function(){this.previewed_index=[];this.viewed_index=[];this.impressions=[];this.previewed=[];this.viewed=[];},'store':function(){if(this.params!=null&&(this.impressions.length>0||this.previewed.length>0||this.viewed.length>0)){if(this.params.num_results>25&&this.impressions.length>5){$.cspAjax({'url':'/track/impressions.php','data':{'funct':'store_impressions_ajax','impressions':this.impressions.join(','),'previewed':this.previewed.join(','),'previewed_index':this.previewed_index.join(','),'viewed':this.viewed.join(','),'viewed_index':this.viewed_index.join(','),'types':this.params.types.join(','),'local_phrase':this.params.term,'en_phrase':this.params.en_term,'domain':window.location.host,'language':csp.locale.lang,'country':csp.COUNTRY},'type':'POST','async':false});}}
this.clear();},'get_index':function(elem){return(elem.index()+1)+parseInt(this.params.start);},'track':{'init':function(){this.impressions.init();this.previewed.init();this.viewed.init();}}};$(document).ready(function(){csp.search.tracking.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search.tracking.track=csp.search.tracking.track||{};csp.search.tracking.track.impressions={'time_out':null,'add_visible_result':function(idx,elem){var id=$(elem).find('img.thumb-hover').data('id');if(typeof(id)!='undefined'&&id!=null&&id!=''){csp.search.tracking.push(csp.search.tracking.impressions,id);}
if(csp.search.tracking.debug)$(elem).css('background-color','LightSteelBlue');},'parse_visible':function(event,data){if(data!==undefined){if(csp.search.tracking.params.en_term!=data.params.en_term||csp.search.tracking.params.types.join(':')!=data.params.types.join(':')){csp.search.tracking.store();csp.search.tracking.params=data.params;}}
var pre_parse_size=csp.search.tracking.impressions.length;$('div.img_container:visible:impression').each($.proxy(this.add_visible_result,this));if(csp.search.tracking.debug){var added=(csp.search.tracking.impressions.length-pre_parse_size),total=csp.search.tracking.impressions.length,search=csp.search.tracking.params.en_term;console.log('Added (%d) Impressions, (%d) Total Impressions, (%s) Search Phrase.',added,total,search);}},'view_change':function(){window.clearTimeout(this.time_out);this.time_out=window.setTimeout($.proxy(this.parse_visible,this),350);},'init':function(){$(window).resize($.proxy(this.view_change,this));$(window).scroll($.proxy(this.view_change,this));}};$(document).ready(function(){csp.search.tracking.track.impressions.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search.tracking.track=csp.search.tracking.track||{};csp.search.tracking.track.previewed={'current_preview':null,'current_preview_index':null,'preview_timmer':null,'store_preview':function(){var pre_parse_size=csp.search.tracking.previewed.length;if(this.current_preview!=null){csp.search.tracking.push(csp.search.tracking.previewed,this.current_preview);}
if(this.current_preview_index!=null){csp.search.tracking.push(csp.search.tracking.previewed_index,this.current_preview_index);}
if(csp.search.tracking.debug){var added=(csp.search.tracking.previewed.length-pre_parse_size),total=csp.search.tracking.previewed.length,search=csp.search.tracking.params.en_term;console.log('Added (%d) Previews, (%d) Total Previews, (%s) Search Phrase.',added,total,search);}},'preview_on':function(event,data){if(this.current_preview!=data.id){window.clearTimeout(this.preview_timmer);this.preview_timmer=window.setTimeout($.proxy(this.store_preview,this),500);this.current_preview=data.id;this.current_preview_index=csp.search.tracking.get_index($(event.target).closest('div.img_container'));}},'preview_off':function(event,data){window.clearTimeout(this.preview_timmer);this.current_preview=null;this.current_preview_idx=null;},'init':function(){$('#search_results').on('preview_on','img.thumb-hover',$.proxy(this.preview_on,this));$('#search_results').on('preview_off','img.thumb-hover',$.proxy(this.preview_off,this));}};$(document).ready(function(){csp.search.tracking.track.previewed.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search.tracking.track=csp.search.tracking.track||{};csp.search.tracking.track.viewed={'viewed':function(event){if($(event.target).hasClass('img_container')){var div=$(event.target);}else{var div=$(event.target).closest('div.img_container');}
if(event.which<3){var id=div.find('img.thumb-hover').data('id');var index=csp.search.tracking.get_index(div);var pre_parse_size=csp.search.tracking.viewed.length;if(id!=null){csp.search.tracking.push(csp.search.tracking.viewed,id);}
if(index!=null){csp.search.tracking.push(csp.search.tracking.viewed_index,index);}
if(csp.search.tracking.debug){var added=(csp.search.tracking.viewed.length-pre_parse_size),total=csp.search.tracking.viewed.length,search=csp.search.tracking.params.en_term;console.log('Added (%d) Views, (%d) Total Views, (%s) Search Phrase.',added,total,search);}}},'init':function(){$('#search_results').on('mouseup','div.img_container',$.proxy(this.viewed,this));}};$(document).ready(function(){csp.search.tracking.track.viewed.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.debug={'query_active':false,'debug_active':false,'on':function(){$('#debug_expand').hide();this.query_active=true;if(!this.libs_loaded()){this.load_libs();}else{this.display_controls();}
return null;},'debug_mappings':{'Title / Description / Keywords':/max plus 0\.01 times others of:/,'Photographer\'s Approval Percentage':/approval_percent/,'Photographer\'s Earnings Velocity':/earnings_velocity/,'Image Earnings Velocity':/image_ev/,'Image Recency':/image_recency/,'Photo Type Boost':/imagetype/,'Downloads':/downloads/,'SDS Boost':/sds/,'CTR Boost':/ctr/,'PPS':/pps/},'debug_toggle':function(){this.debug_active=!this.debug_active;var params=csp.search.get_params();params.debug=this.debug_active;csp.search.load.update(params);},'display_controls':function(){$('#search_page').prepend(this.controls);return null;},'off':function(){$('#debug_expand').show();this.hide_controls();return null;},'libs':{'lib/jquery.knob.js':false},'libs_loaded':function(){for(var lib in this.libs){if(this.libs.hasOwnProperty(lib)&&!this.libs[lib])return false;}
return true;},'lib_loaded':function(){this.libs[this.lib]=true;if(this.scope.libs_loaded()){$.getJSON('/media/js/search/debug/data.json',$.proxy(this.scope.load_search_debug_data,this.scope));}
return null;},'load_libs':function(){for(var lib in this.libs){if(this.libs.hasOwnProperty(lib)){$.getScript(csp.STATIC_PATH+'/js/'+lib,$.proxy(this.lib_loaded,{'libs':this.libs,'lib':lib,'scope':this}));}}
return null;},'extra_toggle':function(event){event.stopPropagation();var elem=$(event.target);elem.closest('div.extra').find('div').toggle();if(elem.closest('div.extra').width()==350){elem.closest('div.extra').css({'z-index':'5','width':'auto'});}else{elem.closest('div.extra').css({'z-index':'25','width':'350px'});}
return false;},'data_sort':function(a,b){return parseFloat(b.weight)-parseFloat(a.weight);},'process_data':function(data_raw,term){var match=0,data=[];term=term.split(' ').sort().join(' ');for(x=0;x<data_raw.length;x++){var rdata=data_raw[x].split('|'),pdata={'weight':(parseFloat(rdata[1])*10).toFixed(1),'match':(term==rdata[0]),'phrase':rdata[0]};if(pdata.match)match=pdata.weight;data.push(pdata);}
data.sort(this.data_sort);return{'match':match,'data':data};},'debug_output_data':function(data){var html='score : '+data.value.toFixed(3);data.details.sort(this.debug_data_sort);for(x=0;x<data.details.length;x++){var detail=data.details[x],percentage=Math.round((detail.value/data.value)*100),description=detail.description;for(title in this.debug_mappings){if(this.debug_mappings.hasOwnProperty(title)&&this.debug_mappings[title].test(detail.description)){description=title;break;}}
html+='<br/>'+percentage+'% - '+detail.value.toFixed(3)+' : '+description;if(detail.description=='max plus 0.01 times others of:'){for(y=0;y<detail.details.length;y++){var sub_detail=detail.details[y];html+='<br/>&nbsp;&nbsp;&nbsp;'+sub_detail.value.toFixed(3)+' : '+sub_detail.description;}}}
return html;},'output_data':function(data){var html='';for(x=0;x<data['data'].length;x++){var rec=data['data'][x],str=rec.weight+'&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;'+rec.phrase+'<br/>';if(rec.match)str='<span style="font-weight:bold;">'+str+'</span>';html+=str;}
return html;},'output_html_data':function(result,type){var type_style=(type=='sds')?{'background-color':'Orange','position':'relative','text-align':'left','cursor':'pointer','color':'#000000','padding':'3px','z-index':'5'}:{'background-color':'SteelBlue','position':'relative','text-align':'left','cursor':'pointer','color':'#000000','padding':'3px','z-index':'5'}
if(result.hasOwnProperty(type)){var raw_data=this.process_data(result[type].split('; '),result.debug_term);return $('<div/>').append($('<div/>').html(type+' : '+raw_data.match),$('<div/>').addClass('data').html(this.output_data(raw_data)).hide()).addClass('extra').css(type_style);}},'debug_output':function(result){if(result.debug!=undefined&&result.debug!=''){var debug_data=this.debug_output_data(result.debug);return $('<div/>').append($('<div/>').html('score : '+result.debug.value.toFixed(3)),$('<div/>').addClass('data').html(debug_data).hide()).addClass('extra').css({'background-color':'maroon','position':'relative','text-align':'left','cursor':'pointer','color':'#FFFFFF','padding':'3px','z-index':'5'});}},'debug_data_sort':function(a,b){return parseFloat(b.value)-parseFloat(a.value);},'get_debug_params':function(){data_extra={};for(var knob_name in this.knobs){if(this.knobs.hasOwnProperty(knob_name)){var row={};var field=this.knobs[knob_name];if(data_extra[field.type]==undefined)data_extra[field.type]={};data_extra[field.type][knob_name]=field.value;}}
return JSON.stringify(data_extra);},'update_params':function(){var params=csp.search.get_params();params.extra=this.get_debug_params();params.extra=(!$.isEmptyObject(params.extra))?params.extra:null;csp.search.load.update(params);},'load_search_debug_data':function(data){this.knobs=data.knobs;this.styles=data.styles;this.build_controls();return null;},'load_algo_data':function(data){var algo=JSON.parse(data);for(var type in algo){if(algo.hasOwnProperty(type)){for(var field in algo[type]){if(algo[type].hasOwnProperty(field)){if(this.knobs[field].type==type){this.knobs[field].value=algo[type][field];}}}}}
this.build_knobs();this.update_params();},'load_algo':function(event){$('input.algo-name').val($(event.target).html());this.load_algo_data($(event.target).data('algo'));},'get_saved_algos':function(){var algos={};if($.cookie('search_algos')!=null){var temp_algos=$.cookie('search_algos').split('~~');for(var x=0;x<temp_algos.length;x++){var temp_algo_raw=temp_algos[x];var temp_algo=temp_algo_raw.split('||');algos[temp_algo[0]]=temp_algo[1];}}
return algos;},'store_saved_algos':function(algos){var algos_list=[];for(var name in algos){if(algos.hasOwnProperty(name)){algos_list.push(name+'||'+algos[name]);}}
$.cookie('search_algos',algos_list.join('~~'),{'expires':5});},'list_algos':function(){this.algo_list.empty();var algos=this.get_saved_algos();for(var name in algos){if(algos.hasOwnProperty(name)){this.algo_list.append($('<li/>').css({'list-style':'none','cursor':'pointer','display':'inline-block','margin-left':'15px','color':'blue','text-decoration':'underline','vertical-align':'middle'}).html(name).data('algo',algos[name]));}}},'save_algo':function(){var input=$('input.algo-name');if(input.val()==''){input.focus().css('border','2px solid red');return false;}
var algos=this.get_saved_algos();algos[input.val()]=this.get_debug_params();this.store_saved_algos(algos);this.list_algos();input.val('');},'build_knobs':function(){this.knob_uls.query_fields.empty().width(0);this.knob_uls.boost_functions.empty().width(0);for(var knob_name in this.knobs){if(this.knobs.hasOwnProperty(knob_name)){var li=$('<li/>').css({'display':'inline-block','padding':'10px','text-align':'center','width':'100px'});li.append($('<div/>').html(this.knobs[knob_name].title));this.knobs[knob_name].knob=$('<input/>').val(this.knobs[knob_name].value).knob({'release':$.proxy(this.knob_change,this.knobs[knob_name]),'fgColor':((this.knobs[knob_name].type=='query_fields')?'#F1824B':'#038DD4'),'bgColor':'#DDDDDD','increment':.25,'thickness':.3,'width':75,'max':25});this.knob_uls[this.knobs[knob_name].type].width(this.knob_uls[this.knobs[knob_name].type].width()+120);li.append(this.knobs[knob_name].knob);this.knob_uls[this.knobs[knob_name].type].append(li);}}},'import_algo':function(){$('body').append($('<div/>').addClass('popup').css({'background-color':'white','word-wrap':'break-word','position':'absolute','padding':'15px','width':'500px','left':'0px','top':'0px'}).append($('<div/>').html('close').click(function(){$(this).closest('div.popup').remove();}),$('<br/>'),$('<textarea/>').css('width','490px'),$('<input/>').attr('type','submit').val('Import').click(function(){var input=$(this).closest('div.popup').find('textarea').val();csp.search.debug.load_algo_data(input);$(this).closest('div.popup').remove();})));},'export_algo':function(){var data=this.get_debug_params();$('body').append($('<div/>').addClass('popup').css({'background-color':'white','word-wrap':'break-word','position':'absolute','padding':'15px','width':'500px','left':'0px','top':'0px'}).append($('<div/>').html('close').click(function(){$(this).closest('div.popup').remove();}),$('<br/>'),$('<div/>').html(data)));},'build_controls':function(){this.controls=$('<div/>').css(this.styles.controls);this.knob_uls={'query_fields':$('<ul/>').css(this.styles.query_fields),'boost_functions':$('<ul/>').css(this.styles.boost_functions)};this.build_knobs();this.algo_list=$('<ul/>').css('margin-bottom','5px');var controls=$('<div/>').css(this.styles.controls_menu).append(this.algo_list.on('click','li',$.proxy(this.load_algo,this)),$('<span/>').css(this.styles.controls_menu_span).html('Collapse').click($.proxy(this.off,this)),$('<span/>').css(this.styles.controls_menu_span).html('Toggle Debug').click($.proxy(this.debug_toggle,this)),$('<span/>').css(this.styles.controls_menu_span).html('Export Algo').click($.proxy(this.export_algo,this)),$('<span/>').css(this.styles.controls_menu_span).html('Import Algo').click($.proxy(this.import_algo,this)),$('<div/>').append($('<input/>').attr('type','text').addClass('algo-name'),$('<input/>').attr('type','submit').val('Save Algo').click($.proxy(this.save_algo,this))).css({'float':'right','display':'inline-block','width':'250px'}));this.controls.append(this.knob_uls.query_fields,this.knob_uls.boost_functions,controls);this.display_controls();this.list_algos();},'knob_change':function(v){this.value=v;csp.search.debug.update_params();},'hide_controls':function(){this.controls.detach();},'init':function(){if($('#debug_expand').length>0){$('#search_results').on('click','div.extra div',$.proxy(this.extra_toggle,this));$('#debug_expand').click($.proxy(this.on,this));}}};$(document).ready(function(){csp.search.debug.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.sidebar={'float':{'top':160,'follow':true,'enabled':true,'h_padding':20,'min_height_padding':400,'scroll':function(event){if(this.enabled){var float=($(window).scrollTop()>this.top&&$(document).scrollLeft()==0&&this.follow);this.dom.toggleClass('float',float);}else{this.dom.removeClass('float');}},'resize':function(event){this.follow=($(window).height()>(this.dom.height()+this.h_padding)&&$(document).height()>(this.dom.height()+this.min_height_padding));this.scroll(event);},'bind':function(){$(window).resize($.proxy(this.resize,this));$(window).scroll($.proxy(this.scroll,this));},'init':function(){this.dom=$('#sidebar');this.resize();this.bind();}},'update_list':function(){this.dom.find('ul li').removeClass('last');this.dom.find('ul li:visible:last').addClass('last');this.float.resize();},'bind':function(){this.dom.bind('update_list',$.proxy(this.update_list,this));},'init':function(){this.dom=$('#sidebar');this.float.init();this.bind();}};$(document).ready(function(){csp.search.sidebar.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.copyspace={'mapping':['A','B','C','D','E','F','G','H','I'],'selector':null,'selected':[],'parse':function(idx,elem){this.selected.push($(elem).data('idx'));},'update':function(){var params=csp.search.get_params();this.selected=[];this.selector.find('div.cs').each($.proxy(this.parse,this));var copyspace=this.selected.join('&');if(copyspace!=params.copyspace){params.copyspace=copyspace;csp.search.load.update(params);_gaq.push(['_trackEvent','copyspace_search',copyspace,params.term]);}},'change':function(event){$(event.target).toggleClass('cs',!$(event.target).hasClass('cs'));this.update();},'setup':function(idx,elem){$(elem).data({'idx':this.mapping[idx]});},'create':function(){this.selector.find('div.space').each($.proxy(this.setup,this)).click($.proxy(this.change,this)).hoverClass();$('#sidebar_copyspace_row').show();},'init':function(){this.selector=$('#sidebar_copyspace');if(this.selector.length>0){this.create();$('#sidebar').trigger('update_list');}}};$(document).ready(function(){csp.search.copyspace.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.artist={'input':null,'timeout':null,'close_timeout':null,'last_request':null,'artist_term':'','artists':{},'index':-1,'last_artist_term':null,'submit':function(){var params=csp.search.get_params();if(this.artist_term!=params.artist){params.artist=this.artist_term;csp.search.load.update(params);this.input.val(this.artist_term);}
this.input.removeClass('input-error');this.suggest_hide();},'process':function(){this.artist_term=this.input.val();if(this.index!==-1){this.artist_term=this.suggest.find('li.result:eq('+this.index+')').data('artist');this.submit();}else if(this.artists[this.artist_term.toLowerCase()]!==undefined){this.artist_term=this.artists[this.artist_term.toLowerCase()];this.submit();}else if(this.artist_term==''){this.submit();}else{this.load();}},'highlight':function(idx){var rows=this.suggest.find('li.result').length;this.index=(idx>=0)?((idx>rows)?rows:idx):-1;this.suggest.find('li.result').removeClass('hover');if(idx>=0&&idx<rows){this.suggest.find('li.result:eq('+idx+')').addClass('hover');}},'change':function(event){window.clearTimeout(this.timeout);if(event.keyCode==13){this.process();}else if(event.keyCode==38){this.highlight(this.index-1);}else if(event.keyCode==40){this.highlight(this.index+1);}else{this.suggest_show();this.input.addClass('input-error');this.timeout=window.setTimeout($.proxy(this.process,this),750);}},'blur':function(event){this.close_timeout=window.setTimeout($.proxy(this.suggest_hide,this),500);},'suggest_show':function(){window.clearTimeout(this.close_timeout);this.suggest.show();this.reset();},'suggest_hide':function(){this.suggest.hide();this.reset();},'reset':function(){this.index=-1;this.suggest.find('li:not(.loading)').remove();this.suggest.find('li.loading').show();},'result_enter':function(event){window.clearTimeout(this.close_timeout);this.index=this.suggest.find('li.result').index($(event.target));this.suggest.find('li.result').removeClass('hover');$(event.target).addClass('hover');},'load_response':function(data){this.suggest.find('li.loading').hide();if(data.success){if(this.artist_term==data.term){this.last_artist_term=data.term;for(var x=0,e=data.results.length;x<e;x++){var artist=data.results[x];this.artists[artist.toLowerCase()]=artist;var li=$('<li/>').html(artist).data('artist',artist).addClass('result');this.suggest.append(li);}}}else{this.suggest.append($('<li/>').html(data.none));}},'load':function(){if(this.last_artist_term!==this.artist_term&&this.artist_term!==''&&this.artist_term!==null){this.suggest_show();if(this.last_request!==null)this.last_request.abort();this.last_request=$.cspAjax({'url':'/search_ajax.php?artist_suggest='+encodeURIComponent(this.artist_term),'success':$.proxy(this.load_response,this),'dataType':'json','data':{'funct':'artist_suggest','term':this.artist_term},'type':'POST','async':true});}},'select':function(event){if($(event.target).data('artist')!==undefined){this.index=this.suggest.find('li.result').index($(event.target));this.suggest_hide();this.process();}},'init':function(){this.input=$('#sidebar_artist');this.suggest=$('#artist_suggest');if(this.input.length>0){this.input.keyup($.proxy(this.change,this)).blur($.proxy(this.blur,this));this.suggest.on('click','li:not(.loading)',$.proxy(this.select,this));this.suggest.on('mouseenter','li:not(.loading)',$.proxy(this.result_enter,this));$('#sidebar_artist_row').show();$('#sidebar').trigger('update_list');}}};$(document).ready(function(){csp.search.artist.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.search=csp.search||{};csp.search.color={'rgb':null,'time_out':null,'reduce':function(rgb){this.rgb={'r':Math.floor(rgb.r/51.2),'g':Math.floor(rgb.g/51.2),'b':Math.floor(rgb.b/51.2)};},'get_color':function(){return(typeof(this.rgb.r)=='undefined')?'':'r'+this.rgb.r+'g'+this.rgb.g+'b'+this.rgb.b;},'apply':function(){var params=csp.search.get_params();params.colors=this.get_color();csp.search.load.update(params);_gaq.push(['_trackEvent','color_search',params.colors,params.term]);this.control.html(csp.locale.translate('clear').toLowerCase());},'clear':function(){$('a.miniColors-trigger').addClass('empty').css('background-color','');var params=csp.search.get_params();if(params.colors!=''){params.colors='';csp.search.load.update(params);}
this.selector.val('');this.control.hide();},'change':function(hex,rgb){this.control.html(csp.locale.translate('apply').toLowerCase());this.control.show();this.reduce(rgb);},'toggle':function(){var params=csp.search.get_params();if(this.get_color()==params.colors){this.clear();}else{this.apply();}},'init':function(){if($('#sidebar_color').length>0){this.selector=$('#sidebar_color').miniColors({'change':$.proxy(this.change,this)});this.container=$('#sidebar_color_row');this.control=$('#sidebar_color_controls');this.control.click($.proxy(this.toggle,this)).hide();this.container.show();$('#sidebar').trigger('update_list');this.clear();}}};$(document).ready(function(){csp.search.color.init();});}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(c){c.jGestures={};c.jGestures.defaults={};c.jGestures.defaults.thresholdShake={requiredShakes:10,freezeShakes:100,frontback:{sensitivity:50},leftright:{sensitivity:50},updown:{sensitivity:50}};c.jGestures.defaults.thresholdPinchopen=0.05;c.jGestures.defaults.thresholdPinchmove=0.05;c.jGestures.defaults.thresholdPinch=0.05;c.jGestures.defaults.thresholdPinchclose=0.05;c.jGestures.defaults.thresholdRotatecw=5;c.jGestures.defaults.thresholdRotateccw=5;c.jGestures.defaults.thresholdMove=20;c.jGestures.defaults.thresholdSwipe=100;c.jGestures.data={};c.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"];c.jGestures.data.hasGestures=(function(){var k;for(k=0;k<c.jGestures.data.capableDevicesInUserAgentString.length;k++){if(navigator.userAgent.indexOf(c.jGestures.data.capableDevicesInUserAgentString[k])!==-1){return true}}return false})();c.hasGestures=c.jGestures.data.hasGestures;c.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"};jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour",devicemotion_shake01:"shake",devicemotion_shake02:"shakefrontback",devicemotion_shake03:"shakeleftright",devicemotion_shake04:"shakeupdown"},function(l,k){jQuery.event.special[k]={setup:function(){var r=l.split("_");var o=r[0];var m=r[1].slice(0,r[1].length-2);var p=jQuery(this);var q;var n;if(!p.data("ojQueryGestures")||!p.data("ojQueryGestures")[o]){q=p.data("ojQueryGestures")||{};n={};n[o]=true;c.extend(true,q,n);p.data("ojQueryGestures",q);if(c.hasGestures){switch(m){case"orientationchange":p.get(0).addEventListener("orientationchange",a,false);break;case"shake":case"shakefrontback":case"shakeleftright":case"shakeupdown":case"tilt":p.get(0).addEventListener("devicemotion",b,false);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":p.get(0).addEventListener("touchstart",h,false);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":p.get(0).addEventListener("gesturestart",e,false);p.get(0).addEventListener("gestureend",i,false);break;case"pinch":case"rotate":p.get(0).addEventListener("gesturestart",e,false);p.get(0).addEventListener("gesturechange",f,false);break}}else{switch(m){case"tap":case"swipe":p.bind("mousedown",h);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":case"shake":case"tilt":break}}}return false},add:function(n){var m=jQuery(this);var o=m.data("ojQueryGestures");o[n.type]={originalType:n.type};return false},remove:function(n){var m=jQuery(this);var o=m.data("ojQueryGestures");o[n.type]=false;m.data("ojQueryGestures",o);return false},teardown:function(){var r=l.split("_");var o=r[0];var m=r[1].slice(0,r[1].length-2);var p=jQuery(this);var q;var n;if(!p.data("ojQueryGestures")||!p.data("ojQueryGestures")[o]){q=p.data("ojQueryGestures")||{};n={};n[o]=false;c.extend(true,q,n);p.data("ojQueryGestures",q);if(c.hasGestures){switch(m){case"orientationchange":p.get(0).removeEventListener("orientationchange",a,false);break;case"shake":case"shakefrontback":case"shakeleftright":case"shakeupdown":case"tilt":p.get(0).removeEventListener("devicemotion",b,false);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":p.get(0).removeEventListener("touchstart",h,false);p.get(0).removeEventListener("touchmove",g,false);p.get(0).removeEventListener("touchend",j,false);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":p.get(0).removeEventListener("gesturestart",e,false);p.get(0).removeEventListener("gestureend",i,false);break;case"pinch":case"rotate":p.get(0).removeEventListener("gesturestart",e,false);p.get(0).removeEventListener("gesturechange",f,false);break}}else{switch(m){case"tap":case"swipe":p.unbind("mousedown",h);p.unbind("mousemove",g);p.unbind("mouseup",j);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":case"shake":case"tilt":break}}}return false}}});function d(k){k.startMove=(k.startMove)?k.startMove:{startX:null,startY:null,timestamp:null};var l=new Date().getTime();var m;var n;if(k.touches){n=[{lastX:k.deltaX,lastY:k.deltaY,moved:null,startX:k.screenX-k.startMove.screenX,startY:k.screenY-k.startMove.screenY}];m={vector:k.vector||null,orientation:window.orientation||null,lastX:((n[0].lastX>0)?+1:((n[0].lastX<0)?-1:0)),lastY:((n[0].lastY>0)?+1:((n[0].lastY<0)?-1:0)),startX:((n[0].startX>0)?+1:((n[0].startX<0)?-1:0)),startY:((n[0].startY>0)?+1:((n[0].startY<0)?-1:0))};n[0].moved=Math.sqrt(Math.pow(Math.abs(n[0].startX),2)+Math.pow(Math.abs(n[0].startY),2))}return{type:k.type||null,originalEvent:k.event||null,delta:n||null,direction:m||{orientation:window.orientation||null,vector:k.vector||null},duration:(k.duration)?k.duration:(k.startMove.timestamp)?l-k.timestamp:null,rotation:k.rotation||null,scale:k.scale||null,description:k.description||[k.type,":",k.touches,":",((n[0].lastX!=0)?((n[0].lastX>0)?"right":"left"):"steady"),":",((n[0].lastY!=0)?((n[0].lastY>0)?"down":"up"):"steady")].join("")}}function a(l){var k=["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"];c(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",k[((window.orientation/90)+1)],window.orientation].join("")})}function b(r){var k;var t=jQuery(window);var o=t.data("ojQueryGestures");var m=c.jGestures.defaults.thresholdShake;var n=o.oDeviceMotionLastDevicePosition||{accelerationIncludingGravity:{x:0,y:0,z:0},shake:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeleftright:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakefrontback:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeupdown:{eventCount:0,intervalsPassed:0,intervalsFreeze:0}};var q={accelerationIncludingGravity:{x:r.accelerationIncludingGravity.x,y:r.accelerationIncludingGravity.y,z:r.accelerationIncludingGravity.z},shake:{eventCount:n.shake.eventCount,intervalsPassed:n.shake.intervalsPassed,intervalsFreeze:n.shake.intervalsFreeze},shakeleftright:{eventCount:n.shakeleftright.eventCount,intervalsPassed:n.shakeleftright.intervalsPassed,intervalsFreeze:n.shakeleftright.intervalsFreeze},shakefrontback:{eventCount:n.shakefrontback.eventCount,intervalsPassed:n.shakefrontback.intervalsPassed,intervalsFreeze:n.shakefrontback.intervalsFreeze},shakeupdown:{eventCount:n.shakeupdown.eventCount,intervalsPassed:n.shakeupdown.intervalsPassed,intervalsFreeze:n.shakeupdown.intervalsFreeze}};var p;var s;var l;for(k in o){switch(k){case"shake":case"shakeleftright":case"shakefrontback":case"shakeupdown":p=[];s=[];p.push(k);if(++q[k].intervalsFreeze>m.freezeShakes&&q[k].intervalsFreeze<(2*m.freezeShakes)){break}q[k].intervalsFreeze=0;q[k].intervalsPassed++;if((k==="shake"||k==="shakeleftright")&&(q.accelerationIncludingGravity.x>m.leftright.sensitivity||q.accelerationIncludingGravity.x<(-1*m.leftright.sensitivity))){p.push("leftright");p.push("x-axis")}if((k==="shake"||k==="shakefrontback")&&(q.accelerationIncludingGravity.y>m.frontback.sensitivity||q.accelerationIncludingGravity.y<(-1*m.frontback.sensitivity))){p.push("frontback");p.push("y-axis")}if((k==="shake"||k==="shakeupdown")&&(q.accelerationIncludingGravity.z+9.81>m.updown.sensitivity||q.accelerationIncludingGravity.z+9.81<(-1*m.updown.sensitivity))){p.push("updown");p.push("z-axis")}if(p.length>1){if(++q[k].eventCount==m.requiredShakes&&(q[k].intervalsPassed)<m.freezeShakes){t.triggerHandler(k,d({type:k,description:p.join(":"),event:r,duration:q[k].intervalsPassed*5}));q[k].eventCount=0;q[k].intervalsPassed=0;q[k].intervalsFreeze=m.freezeShakes+1}else{if(q[k].eventCount==m.requiredShakes&&(q[k].intervalsPassed)>m.freezeShakes){q[k].eventCount=0;q[k].intervalsPassed=0}}}break}l={};l.oDeviceMotionLastDevicePosition=q;t.data("ojQueryGestures",c.extend(true,o,l))}}function h(l){var k=jQuery(l.currentTarget);k.triggerHandler(c.jGestures.events.touchstart,l);if(c.hasGestures){l.currentTarget.addEventListener("touchmove",g,false);l.currentTarget.addEventListener("touchend",j,false)}else{k.bind("mousemove",g);k.bind("mouseup",j)}var n=k.data("ojQueryGestures");var m=(l.touches)?l.touches[0]:l;var o={};o.oLastSwipemove={screenX:m.screenX,screenY:m.screenY,timestamp:new Date().getTime()};o.oStartTouch={screenX:m.screenX,screenY:m.screenY,timestamp:new Date().getTime()};k.data("ojQueryGestures",c.extend(true,n,o))}function g(t){var v=jQuery(t.currentTarget);var s=v.data("ojQueryGestures");var q=!!t.touches;var l=(q)?t.changedTouches[0].screenX:t.screenX;var k=(q)?t.changedTouches[0].screenY:t.screenY;var r=s.oLastSwipemove;var o=l-r.screenX;var n=k-r.screenY;var u;if(!!s.oLastSwipemove){u=d({type:"swipemove",touches:(q)?t.touches.length:"1",screenY:k,screenX:l,deltaY:n,deltaX:o,startMove:r,event:t,timestamp:r.timestamp});v.triggerHandler(u.type,u)}var m={};var p=(t.touches)?t.touches[0]:t;m.oLastSwipemove={screenX:p.screenX,screenY:p.screenY,timestamp:new Date().getTime()};v.data("ojQueryGestures",c.extend(true,s,m))}function j(r){var v=jQuery(r.currentTarget);var x=!!r.changedTouches;var u=(x)?r.changedTouches.length:"1";var p=(x)?r.changedTouches[0].screenX:r.screenX;var o=(x)?r.changedTouches[0].screenY:r.screenY;v.triggerHandler(c.jGestures.events.touchendStart,r);if(c.hasGestures){r.currentTarget.removeEventListener("touchmove",g,false);r.currentTarget.removeEventListener("touchend",j,false)}else{v.unbind("mousemove",g);v.unbind("mouseup",j)}var m=v.data("ojQueryGestures");var y=(Math.abs(m.oStartTouch.screenX-p)>c.jGestures.defaults.thresholdMove||Math.abs(m.oStartTouch.screenY-o)>c.jGestures.defaults.thresholdMove)?true:false;var B=(Math.abs(m.oStartTouch.screenX-p)>c.jGestures.defaults.thresholdSwipe||Math.abs(m.oStartTouch.screenY-o)>c.jGestures.defaults.thresholdSwipe)?true:false;var A;var t;var n;var l;var k;var q;var w=["zero","one","two","three","four"];var s;for(A in m){t=m.oStartTouch;n={};p=(x)?r.changedTouches[0].screenX:r.screenX;o=(x)?r.changedTouches[0].screenY:r.screenY;l=p-t.screenX;k=o-t.screenY;q=d({type:"swipe",touches:u,screenY:o,screenX:p,deltaY:k,deltaX:l,startMove:t,event:r,timestamp:t.timestamp});s=false;switch(A){case"swipeone":if(x===false&&u==1&&y===false){break}if(x===false||(u==1&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipetwo":if((x&&u==2&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipethree":if((x&&u==3&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipefour":if((x&&u==4&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":if(x&&y===true&&B===true){s=true;q.type=["swipe",((q.delta[0].lastX!=0)?((q.delta[0].lastX>0)?"right":"left"):""),((q.delta[0].lastY!=0)?((q.delta[0].lastY>0)?"down":"up"):"")].join("");v.triggerHandler(q.type,q)}break;case"tapone":case"taptwo":case"tapthree":case"tapfour":if((y!==true&&s!==true)&&(w[u]==A.slice(3))){q.description=["tap",w[u]].join("");q.type=["tap",w[u]].join("");v.triggerHandler(q.type,q)}break}var z={};v.data("ojQueryGestures",c.extend(true,m,z));v.data("ojQueryGestures",c.extend(true,m,z))}v.triggerHandler(c.jGestures.events.touchendProcessed,r)}function e(l){var k=jQuery(l.currentTarget);k.triggerHandler(c.jGestures.events.gesturestart,l);var m=k.data("ojQueryGestures");var n={};n.oStartTouch={timestamp:new Date().getTime()};k.data("ojQueryGestures",c.extend(true,m,n))}function f(l){var k=jQuery(l.currentTarget);var p,m,r,o;var q=k.data("ojQueryGestures");var n;for(n in q){switch(n){case"pinch":p=l.scale;if(((p<1)&&(p%1)<(1-c.jGestures.defaults.thresholdPinchclose))||((p>1)&&(p%1)>(c.jGestures.defaults.thresholdPinchopen))){m=(p<1)?-1:+1;o=d({type:"pinch",scale:p,touches:null,startMove:q.oStartTouch,event:l,timestamp:q.oStartTouch.timestamp,vector:m,description:["pinch:",m,":",((p<1)?"close":"open")].join("")});k.triggerHandler(o.type,o)}break;case"rotate":p=l.rotation;if(((p<1)&&(-1*(p)>c.jGestures.defaults.thresholdRotateccw))||((p>1)&&(p>c.jGestures.defaults.thresholdRotatecw))){m=(p<1)?-1:+1;o=d({type:"rotate",rotation:p,touches:null,startMove:q.oStartTouch,event:l,timestamp:q.oStartTouch.timestamp,vector:m,description:["rotate:",m,":",((p<1)?"counterclockwise":"clockwise")].join("")});k.triggerHandler(o.type,o)}break}}}function i(l){var k=jQuery(l.currentTarget);k.triggerHandler(c.jGestures.events.gestureendStart,l);var n;var o=k.data("ojQueryGestures");var m;for(m in o){switch(m){case"pinchclose":n=l.scale;if((n<1)&&(n%1)<(1-c.jGestures.defaults.thresholdPinchclose)){k.triggerHandler("pinchclose",d({type:"pinchclose",scale:n,vector:-1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"pinch:-1:close"}))}break;case"pinchopen":n=l.scale;if((n>1)&&(n%1)>(c.jGestures.defaults.thresholdPinchopen)){k.triggerHandler("pinchopen",d({type:"pinchopen",scale:n,vector:+1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"pinch:+1:open"}))}break;case"rotatecw":n=l.rotation;if((n>1)&&(n>c.jGestures.defaults.thresholdRotatecw)){k.triggerHandler("rotatecw",d({type:"rotatecw",rotation:n,vector:+1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"rotate:+1:clockwise"}))}break;case"rotateccw":n=l.rotation;if((n<1)&&(-1*(n)>c.jGestures.defaults.thresholdRotateccw)){k.triggerHandler("rotateccw",d({type:"rotateccw",rotation:n,vector:-1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}break}}k.triggerHandler(c.jGestures.events.gestureendProcessed,l)}})(jQuery);(function(window,undefined){'$:nomunge';var $=window.jQuery||window.Cowboy||(window.Cowboy={}),jq_throttle;$.throttle=jq_throttle=function(delay,no_trailing,callback,debounce_mode){var timeout_id,last_exec=0;if(typeof no_trailing!=='boolean'){debounce_mode=callback;callback=no_trailing;no_trailing=undefined;}
function wrapper(){var that=this,elapsed=+new Date()-last_exec,args=arguments;function exec(){last_exec=+new Date();callback.apply(that,args);};function clear(){timeout_id=undefined;};if(debounce_mode&&!timeout_id){exec();}
timeout_id&&clearTimeout(timeout_id);if(debounce_mode===undefined&&elapsed>delay){exec();}else if(no_trailing!==true){timeout_id=setTimeout(debounce_mode?clear:exec,debounce_mode===undefined?delay-elapsed:delay);}};if($.guid){wrapper.guid=callback.guid=callback.guid||$.guid++;}
return wrapper;};$.debounce=function(delay,at_begin,callback){return callback===undefined?jq_throttle(delay,at_begin,false):jq_throttle(delay,callback,at_begin!==false);};})(this);;(function(csp,$,undefined){var RelatedSearches=function(){csp.search.results.container.on('csp_results_loaded',_.bind(this.load,this));var mobile=(/iphone|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()));if(mobile){$("#suggested_searches > i").css("visibility","hidden");$("#suggested_searches img").css("opacity","1");}
$("#suggested_searches").on('scroll',function(){var back=($("#suggested_searches").scrollLeft()>0);$("#suggested_searches .back").toggle(back);var next=($("#suggested_searches").scrollLeft()<$("#suggested_searches")[0].scrollWidth-$("#suggested_searches_container").width());$("#suggested_searches .next").toggle(next);});$("#suggested_searches > i.next").on('click',function(){$("#suggested_searches").animate({'scrollLeft':($("#suggested_searches").scrollLeft()+$("#suggested_searches_container").width())},500);});$("#suggested_searches > i.back").on('click',function(){$("#suggested_searches").animate({'scrollLeft':($("#suggested_searches").scrollLeft()-$("#suggested_searches_container").width())},500);});};RelatedSearches.prototype={'template':_.template('<span onclick="doSearch(\'<%= phrase %>\', \'<%= type %>\')">'+'<strong><%= phrase %></strong>'+'<% _.each(images, function(image){ %>'+'<img src="http://m.thumbs.canstockphoto.com/canstock<%= image %>.jpg" />'+'<% }) %>'+'</span>'),'load':function(event,data){if(csp.search.compare.same(csp.search.display_params,data.params,'display_load')){this.load_process(data);}},'load_process':function(data){if(data.params.start==0){$('#suggested_searches_container').toggle(!_.isEmpty(data.related));$('#suggested_searches span, #suggested_searches a').remove();_.each(data.related,function(search){var html=this.template(_.extend(search,{'type':data.params.types}));$('#suggested_searches').append(html);},this);}}};$(function(){new RelatedSearches();});window.doSearch=function(term,type){_gaq.push(['_trackEvent','related_search','click']);window.location='/search.php?'+$.param({'type':type,'term':term});};}(window.canstockphoto=window.canstockphoto||{},jQuery));(function(csp,$,undefined){csp.GridNext=function(){this.$el=$('#search_results div.grid-next');this.$arrow=this.$el.find('div.grid-next-arrow');};csp.GridNext.prototype={'update':function(row){if($('#search_results').hasClass('results-grd')){var arrow_space=(2+10+20+70);if(row.remaining>=arrow_space){var padding=((row.height-90)/2),width=(row.remaining-arrow_space);this.$el.css({'padding-bottom':padding,'padding-top':padding}).removeClass('hide');this.$arrow.css({'text-indent':(width<110)?'-9999px':'0px','width':width});}else{this.$el.addClass('hide');}}}};csp.GridCell=function($el,ratio){this.ratio=ratio,this.$el=$el;};csp.GridCell.prototype={'process':function(rheight){var ratio=parseFloat(this.ratio),width=Math.min(parseInt(rheight*ratio),350);var $container=this.$el.closest('span.thumb-container');this.$el.closest('div.img_container').css('height',rheight);$container.find('span.thumb-mask').css({'height':rheight,'width':width});$container.css({'margin-top':'0px','height':'auto'});if((Math.round(ratio*100)/100)<1){this.$el.css({'height':rheight,'width':'auto'});$container.css('width',width);}else{var r_ratio=parseFloat(this.$el.data('ratio'));if((width/r_ratio)<rheight){var sheight=parseInt(width/r_ratio);$container.css({'margin-top':parseInt((rheight-sheight)/2),'height':sheight+'px'});}
this.$el.css({'height':'auto','width':width});}
return width;}};csp.GridRow=function(){this.padding=0,this.cells=[],this.height=0,this.width=0;};csp.GridRow.prototype={'max':200,'add':function($elem){var ratio=parseFloat($elem.data('ratio'));var width=Math.min(Math.floor(ratio*this.max),350);this.cells.push(new csp.GridCell($elem,(width/this.max)));this.padding+=(2+10);this.width+=width;},'process':function(cwidth){this.remaining=(cwidth-this.padding);this.height=Math.min(Math.floor(this.max*this.remaining/this.width),this.max);$.each(this.cells,$.proxy(this.process_cell,this));return this.remaining;},'process_cell':function(cell_idx,cell){this.remaining-=cell.process(this.height);}};csp.Grid=function(){var resize=$.throttle(500,$.proxy(this.resize,this));this.grid_next=new csp.GridNext();$('#search_results').on('results_displayed',resize);$(window).on('resize load',resize);$(document).on('ready',resize);};csp.Grid.prototype={'resize':function(){if($('#search_results').hasClass('results-grd')){var rows=[],row=new csp.GridRow(),cwidth=$('#search_results').width();if(cwidth<=10){setTimeout($.proxy(this.resize,this),500);return;}
$('div.img_container span.thumb-container img').each(function(idx,elem){row.add($(elem));if(row.width>=(cwidth-row.padding)){rows.push(row);row=new csp.GridRow();}});if(row.cells.length>0)rows.push(row);$.each(rows,function(idx,row){row.process(cwidth);});this.grid_next.update(row);}}};csp.grid=new csp.Grid();})(window.canstockphoto,jQuery);